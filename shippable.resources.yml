# This resources are only used for Listing Service

####################################################################
# Refer to http://docs.shippable.com/reference/resources-overview/ #
####################################################################

resources:

  # Docker Image Options to run the container
  - name: gateway-service-docker-opts
    type: dockerOptions
    version:
      memory: 512
      memoryReservation: 256
      cpuShares: 128
      portMappings:
        - 0:3000
      publishAllPorts : true
      logConfig:
        type: awslogs
        options:
          awslogs-group: "app_ecs"
          awslogs-region: "ap-southeast-2"
          awslogs-stream-prefix: "gateway-service"

  # MASTER Docker Image for the listing service
  - name: gateway-service-repo
    type: gitRepo
    integration: production-github
    pointer:
      sourceName: bauerxcelmedia/gateway-service
      branch: master

  # Slack connection
  - name: gateway-service-slack-notifications
    type: notification                          #required
    integration: slack-bauerxcelmedia
    pointer:
      recipients:
        - "#au-shippable"
        
  # Slack connection
  - name: gateway-service-deployment-notifications
    type: notification                          #required
    integration: slack-bauerxcelmedia
    pointer:
      recipients:
        - "#survivors_outlast_au"

  - name: gateway-service-master-docker-registry
    type: image
    pointer:
      sourceName: 317367993082.dkr.ecr.ap-southeast-2.amazonaws.com/gateway-service
    seed:
      versionName: latest

  # Feature BRANCH Docker Image for the listing service
  # - name: gateway-service-branch-docker-registry
  #   type: image
  #   pointer:
  #     sourceName: 317367993082.dkr.ecr.ap-southeast-2.amazonaws.com/gateway-service
  #   seed:
  #     versionName: latest

  # Seed Release version
    # for Rollback refer to below URL
    # http://docs.shippable.com/deploy/rollback/#rolling-back-your-deployments
  - name: gateway-service-version
    type: version
    seed:
      versionName: "1.0.0"

  ####################################
  # NON PROD environment configuration
  ####################################

  # AWS Non Prod Cluster
  - name: gateway-service-sit-ecs
    type: cluster
    integration: digital-nonprod-AWS
    pointer:
      sourceName : "app_ecs"
      region: "ap-southeast-2"

  # AWS SIT load Balancer - Listing - MASTER branch
  - name: gateway-service-sit-alb
    type: loadBalancer
    pointer:
      sourceName: arn:aws:elasticloadbalancing:ap-southeast-2:014901580825:targetgroup/gateway-service-sit/da32e870c119f00f
      method: application

  # AWS SIT:8080 load Balancer - Listing service - feature BRANCH
  # - name: gateway-service-sit-alb-branch
  #   type: loadBalancer
  #   pointer:
  #     sourceName: #change to something that exists "arn:aws:elasticloadbalancing:ap-southeast-2:014901580825:targetgroup/gateway-service-branch-sit/9465aacd1ebea5d1"
  #     method: application

  # AWS TEST load Balancer - Listing service SIT - MASTER branch
  - name: gateway-service-sit-params
    type: params
    version:
      params:
        NODE_ENV: "dev"
        APP_ENV: "sit"
        APM_KEY: "c777240932e6282ffacc6a42ae6a0709426522bb"
        # APP_SERVICES_ACCESS_KEY - SIT
        secure: LqN4OOVQ1rBBqiRwlom7xyTQ/TSfMawsZD2WuDw3Bk43A9j1MYzBLWAD/nRySsDWiJUBqPfQOwR614hplC2eZUs5dCO/8A09nSUjJUUkdvBnNzT4HU4cZcG8YtM8pIfvw7qnxNcATH35J+iYxjrJvKiJU2fZMaCd/8/UGADrZH6v1BRrjrujkvNcniMLIzqmjRY+dHB94WV9CoXfGKTb1T5nM715/3070YW+3Aa4C+HJSsP2krJRw7icOE13uieofQVZcaNNy1xaodgIr7zmLuUyL78zjuVzvrn867Nq/lYa8/9mWp6Ssj/jRR7tUGzPNib0YT1KV/zovbq5WJtOJQ==

  ####################################
  # PROD environment configuration
  ####################################

  # # AWS Non Prod Cluster
  # - name: gateway-service-prod-ecs
  #   type: cluster
  #   integration: digital-prod-AWS
  #   pointer:
  #     sourceName : "services_ecs"
  #     region: "ap-southeast-2"

  # # AWS PROD load Balancer - Listing service PROD - internal - MASTER branch
  # - name: gateway-service-prod-alb
  #   type: loadBalancer
  #   pointer:
  #     sourceName: #change to something that exists "arn:aws:elasticloadbalancing:ap-southeast-2:622156575630:targetgroup/gateway-service-prod/35e44a14a1fc3422"
  #     method: application

  # # PROD parameters
  # - name: gateway-service-prod-params
  #   type: params
  #   version:
  #     params:
  #       NODE_ENV: "production"
  #       APP_ENV: "prod"
  #       APP_MOUNT_PATH: "listing/"
  #       APM_KEY: "c777240932e6282ffacc6a42ae6a0709426522bb"
  #       # APP_SERVICES_ACCESS_KEY = PROD
  #       secure: grgiNv7l5G1a/BJy/ZdeUkec8qe0FqiYCUpPQh/MATI3p69wqpA5KW9Rx3JU4s6eI62yv13hvsliux6mHPDlM4pqXttCONIFxwkuJm+9dgtGWlruWD+EKaglPa+gB7yVwDQgHgBqA/dwosrD0hiEg5deEU3yeNhht0kOwsPOTfeD89hFM6qk1UmKIfl8VouhIyFLqIV97anXc94gM9G7+vDvg5GMF0eSatjYjdgQ80iRpkqMPkA1cH/Dn0ptIgIXtkv2f8RxeJ/OSAhjCpH+/My7PQC/j6Khs7QhSgaMGSy55Nxyg5qd+j4zB0bAfm+6EUvvIc0ULXlfRlbIsyJoNw==