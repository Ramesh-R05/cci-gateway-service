# This resources are only used for Listing Service

####################################################################
# Refer to http://docs.shippable.com/reference/resources-overview/ #
####################################################################

resources:

  # Docker Image Options to run the container
  - name: gateway-service-docker-opts
    type: dockerOptions
    version:
      memory: 512
      memoryReservation: 256
      cpuShares: 128
      portMappings:
        - 0:3000
      publishAllPorts : true
      logConfig:
        type: awslogs
        options:
          awslogs-group: "app_ecs"
          awslogs-region: "ap-southeast-2"
          awslogs-stream-prefix: "gateway-service"

  # MASTER Docker Image for the gateway service
  - name: gateway-service-repo
    type: gitRepo
    integration: production-github
    pointer:
      sourceName: bauerxcelmedia/gateway-service
      branch: master

  # Slack connection
  - name: gateway-service-slack-notifications
    type: notification                          #required
    integration: slack-bauerxcelmedia
    pointer:
      recipients:
        - "#au-shippable"
        
  # Slack connection
  - name: gateway-service-deployment-notifications
    type: notification                          #required
    integration: slack-bauerxcelmedia
    pointer:
      recipients:
        - "#survivors_outlast_au"

  - name: gateway-service-master-docker-registry
    type: image
    pointer:
      sourceName: '317367993082.dkr.ecr.ap-southeast-2.amazonaws.com/gateway-service'
    seed:
      versionName: latest  

  # Seed Release version
    # for Rollback refer to below URL
    # http://docs.shippable.com/deploy/rollback/#rolling-back-your-deployments
  - name: gateway-service-version
    type: version
    seed:
      versionName: "1.0.0"

  ####################################
  # NON PROD environment configuration
  ####################################

# NON PROD - Number of task to run in AWS cluster
  - name: gateway-service-replicas-non-prod
    type: replicas
    version:
      count: 3

  # AWS Non Prod Cluster
  - name: gateway-service-sit-ecs
    type: cluster
    integration: digital-nonprod-AWS
    pointer:
      sourceName : "app_ecs"
      region: "ap-southeast-2"

  # AWS SIT load Balancer - Listing - MASTER branch
  - name: gateway-service-sit-alb
    type: loadBalancer
    pointer:
      sourceName: 'arn:aws:elasticloadbalancing:ap-southeast-2:014901580825:targetgroup/gateway-service-sit/da32e870c119f00f'
      method: application

  # AWS TEST load Balancer - Listing service SIT - MASTER branch
  - name: gateway-service-sit-params
    type: params
    version:
      params:
        NODE_ENV: "dev"
        APP_ENV: "sit"
        APM_KEY: "c777240932e6282ffacc6a42ae6a0709426522bb"
        # APP_SERVICES_ACCESS_KEY - SIT
        secure: qFti61PYKplYwTM1P4iRgpfVMTvdWhmOgMz7H2HpSWOrwv2HjVo6dkV96V9+F/FtZUtSYrppwqm3j+vtukDYLHdKaq3bx38Pv1jjtsjMzYRRzOatc/ZuQxnXTDBdyDQwkTLRzMAoRoWTBdY4Gnqksw9+OA2/5/csAt1aFh+WbLnlUw1JmuNbo4fMbjNhOjsbo6vJSRms8yKWsulhrcTrM5xdfjhJEKPFuGz7VEliyzJYJYX2cSEFHHinvbBsfiuJsdhWh0lDeIJcTB64Qy6FetVTZd+eClaP3vYLCaMBNfx5tYZCgyyYMpxjs4xOZmnD5GInM4yYkOU1LSqHsZlBuQ==

  ####################################
  # PROD environment configuration
  ####################################

   # PROD - Number of task to run in AWS cluster
  - name: gateway-service-replicas-production
    type: replicas
    version:
      count: 3

  # AWS Prod Cluster
  - name: gateway-service-prod-ecs
    type: cluster
    integration: digital-prod-AWS
    pointer:
      sourceName : "app_ecs"
      region: "ap-southeast-2"

  # AWS PROD load Balancer - Listing service PROD - internal - MASTER branch
  - name: gateway-service-prod-alb
    type: loadBalancer
    pointer:
      sourceName: 'arn:aws:elasticloadbalancing:ap-southeast-2:622156575630:targetgroup/gateway-service-prod/fc00f62d417d8be1'
      method: application

  # PROD parameters
  - name: gateway-service-prod-params
    type: params
    version:
      params:
        NODE_ENV: "production"
        APP_ENV: "prod"
        APM_KEY: "c777240932e6282ffacc6a42ae6a0709426522bb"
        # APP_SERVICES_ACCESS_KEY = PROD
        secure: JxAG+d9TkYtegjhBAHg+6jsC14AL6FbSk1F8HiqVo62xad2AC3tjPNbe0jWzsJFGgFb45sOGbg5e0iRGIiUvireYhqI7f7fFKtn7+lWMb7/2JYJkq/z58P/TWdZkDDyLp8QqykIbocmYh2wRTck3cXpNFLBx2x5OKBLV6VkPp7miZTIk+0JgjXJXWTBFxSoOPDoOZQZVDuHOLELRzEfjInX3cPdjDMyp9E3jpqSuWtSsPe43IOCfc9Mx0E6mHAEnYwPy8xBkxyx3veNMXCKNjbwkZhVqsO7K2t4qc05NwyZeK20aKXag8kcUgf3A0rTcLvA35EGLAkd+KYn68WsyBw==